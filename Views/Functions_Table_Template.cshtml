@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using System.Text.RegularExpressions;
@using System.Web;
@{
    Layout = "~/Views/Layout.cshtml";
    //The following node ID needs to be replaced if the corresponding node is removed from CMS.
    var functionRootNode = Umbraco.Content(1174);
    var venueNode = functionRootNode.Children.Where("DocumentTypeAlias==\"Functions_venues\"").FirstOrDefault();
    var loopCounter = 0;
    var venueLoopCounter = 0;
}

@Html.Partial("_header_bottom_nav")

<br /><br /><br />
<div class="container transit template_content">

    <div class="row">
        <div class="col-lg-1 visible-lg">
        </div>
        <article class="col-lg-10 col-xs-12" id="table-striped-inside">
            @Html.Raw(CurrentPage.mainEditor)
        </article>
    </div>

    <div class="row divider">
        <div class="col-lg-1 visible-lg">
        </div>
        <div class="col-xs-12 col-lg-10">
            <hr>
        </div>
    </div>
    </div>
    <div class="container two_column_posts transit">
    <div class="row">
        <div class="col-lg-1 visible-lg"></div>
        @foreach (var item in functionRootNode.Children){
            if(item.DocumentTypeAlias == "Function_page" && item.Id != CurrentPage.Id ){
                if(loopCounter < 2 ){
                <section class="col-sm-6 col-lg-5 col-xs-12">
                    <div class="function_list_item">
                        <a href="@item.Url"><img src="@Umbraco.Media(item.featuredImage).UmbracoFile" class="img-responsive" /></a>
                        <h1>@item.pageTitle</h1>
                        <p>
                            @{
                                string content = Umbraco.Truncate(item.description, 350, true).ToString();
                                string pattern = @"<[^>]*>";
                                string replacement = "";
                                Regex rgx = new Regex(pattern);
                                string processedContent = rgx.Replace(content, replacement);
                                var htmlContent = HttpUtility.HtmlDecode(processedContent);
                            }
                            @htmlContent
                        </p>
                        <a class="button button-black read_more" href="@item.Url">
                            read more
                        </a>
                    </div>
                </section>
                }
                loopCounter++;
            }
        }

    </div>
    <div class="row divider" >
        <div class="col-lg-1 visible-lg">
        </div>
        <div class="col-xs-12 col-lg-10">
            <hr>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-1 visible-lg">
        </div>
        <div class="col-xs-12 col-lg-10">
            <div class="heading"></div>
            <h2 class="large">VENUES</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-1 visible-lg">
        </div>
        <div class="col-xs-12 col-lg-10 three-column-container">
            @foreach (var item in venueNode.Children){
            if(item.DocumentTypeAlias == "Functions_venues_page"){
            <section class="post_list_item col-lg-4 col-sm-6 col-xs-12">
                <img src="@Umbraco.Media(item.featuredImage).UmbracoFile" class="img-responsive venues-img" />
                <h2>@item.pageTitle</h2>
                <p>
                    <b>
                        @item.subTitle
                    </b>
                </p>
                <p>
                    @{
                        /*
                        string content = Umbraco.Truncate(item.description, 350, true).ToString();
                        string pattern = @"<[^>]*>";
                        string replacement = "";
                        Regex rgx = new Regex(pattern);
                        string processedContent = rgx.Replace(content, replacement);
                        var htmlContent = HttpUtility.HtmlDecode(processedContent);*/
                    }
                    @item.exerpt
                </p>
                <a class="learn_more" href="@item.Url">
                    learn more
                </a>
            </section>

            venueLoopCounter++;
            }

            }

        </div>
    </div>
</div>

<!-- Js used only in current page -->
<script type="text/javascript" src="/js/final/stickyMenu2.js"></script>
<script type="text/javascript" src="/js/final/banner_mask_height_init.js"></script>
<script type="text/javascript" src="/js/final/function_menu_remove_last_class.js"></script>
<script type="text/javascript" src="/js/final/striped_table.js"></script>
<script type="text/javascript" src="/js/final/dynamic_content_height_for_postList.js"></script>
